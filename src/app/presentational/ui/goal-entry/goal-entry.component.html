<ion-content>

  <ion-list>
      <ion-item >
        <ion-label>The Goal is to...</ion-label>
        <ion-input type="text" [(ngModel)]="goalTitle" name="title"></ion-input>
        
      
        <!-- <mat-error *ngIf='title.invalid'> Your title doesn't look right. </mat-error> -->
    </ion-item>

    <ion-item  >
      <ion-label>The Importance is: </ion-label>
      <ion-select placeholder="Priority" [(ngModel)]="goalPriority">
        <ion-select-option *ngFor="let prior of priorities" [value]="prior.number">
          {{ prior.text }}
        </ion-select-option> 
      </ion-select>
  </ion-item>

  <ion-item >
    <ion-label>The Difficulty Is: </ion-label>
    <ion-select placeholder="Difficulty"  [(ngModel)]="goalDifficulty">
      <ion-select-option *ngFor="let diff of difficulty" [value]="diff.number">
        {{diff.text}}
      </ion-select-option>
    </ion-select>

  </ion-item> 

  <ion-item >
    <ion-label>The Urgency is:</ion-label>
      <ion-select placeholder="Urgency"  [(ngModel)]="goalUrgency">
        <ion-select-option *ngFor="let urg of urgencyLevels" [value]="urg.number">
          {{ urg.text }}
        </ion-select-option> 
      </ion-select>
  </ion-item>
    
  
  <ion-item  >
    <ion-label>Categorize this as:</ion-label>
    <ion-input
      type="text"
      [(ngModel)]="goalTag"
      name="goal-tag"

    >
    </ion-input>
  </ion-item>

  <ion-item id="goal-date">
    <ion-label>Get this done by: </ion-label>
    <ion-datetime
      displayFormat="YYYY-MM-DD" 
      [(ngModel)]="goalDeadline"
      name="goal-deadline"

    >
    </ion-datetime>
  </ion-item>
</ion-list>


    <form [formGroup] = "goalForm">

      <div formArrayName="goalArray">
        <div *ngFor="let goal of goalArray.controls; let i=index" class="form-group">
            <div [formGroupName]="i" class="milestone-block" *ngIf="goalArray.controls[i].value.show">
              <ion-list >
                    <ion-item disabled = "{{goalTitle === ''}}">
                       <ion-note slot="start" color="tertiary">M</ion-note>
                      <ion-label>Milestone:</ion-label>
                        <ion-input type="text" formControlName="title" name="title"></ion-input>
                      
                    </ion-item>
                        
                    <ion-item disabled = "{{goalTitle === ''}}">
                       <ion-note slot="start" color="tertiary">M</ion-note>
                      <ion-label>The Importance is: </ion-label>
                        <ion-select placeholder="Priority" formControlName="priority">
                          <ion-select-option *ngFor="let prior of priorities" [value]="prior.number">
                            {{ prior.text }}
                          </ion-select-option> 
                        </ion-select>
                      
                    </ion-item>
          
                    <ion-item disabled = "{{goalTitle === ''}}">
                       <ion-note slot="start" color="tertiary">M</ion-note>
                      <ion-label>The Difficulty Is: </ion-label>
                      <ion-select placeholder="Difficulty" formControlName="difficulties">
                        <ion-select-option *ngFor="let diff of difficulty" [value]="diff.number">
                          {{diff.text}}
                        </ion-select-option>
                      </ion-select>
                    
                    </ion-item> 
          
                    <ion-item disabled = "{{goalTitle === ''}}">
                       <ion-note slot="start" color="tertiary">M</ion-note>
                      <ion-label>The Urgency is:</ion-label>
                        <ion-select placeholder="Urgency" formControlName="urgency">
                          <ion-select-option *ngFor="let urg of urgencyLevels" [value]="urg.number">
                            {{ urg.text }}
                          </ion-select-option> 
                        </ion-select>
                      
                    </ion-item>
                    
            
                    <ion-item disabled = "{{goalTitle === ''}}">

                       
                        <ion-badge slot="end" color="primary" (click)="addGoalChild(goal, -1)">
                          <ion-icon name="add-circle-outline"></ion-icon>Task
                        </ion-badge>
                 
                      
                        <ion-badge slot="end" *ngIf="i !== 0"  color="warn" (click)="deleteGoal(i)">
                          <ion-icon name="ban-outline"></ion-icon> 
                      </ion-badge>
               
                    
                      <ion-badge slot="end" 
                        *ngIf="goalArray.controls[i].value.title !== '' && goalArray.controls[i].value.show"
                        color="light" 
                        (click)="goalArray.controls[i].value.show = !goalArray.controls[i].value.show">
                        <ion-icon name="eye-off-outline"></ion-icon> 
                      </ion-badge>
                
      
                    </ion-item>
              </ion-list>
         
                
              
               
                <div formArrayName = "taskChildren">
                  <div *ngFor="let task of getTaskChildren(goal); index as j" class="form-group">
                    <div [formGroupName]="j" class="milestone-block" *ngIf="getTaskChildren(goal)[j].value.show">
                      <ion-list >

                        <ion-item disabled = "{{goalArray.controls[i].value.title === '' || goalTitle === ''}}">
                          <ion-label>Task: </ion-label>
                          <ion-note slot="start" [style.margin-left.em]="'2'" color="secondary">T</ion-note>
                            <ion-input type="text" formControlName="title" name="title"></ion-input>
                            
                        </ion-item>
  
                        <ion-item disabled = "{{goalArray.controls[i].value.title === '' || goalTitle === ''}}">
                          <ion-label>More Details: </ion-label>
                          <ion-note slot="start" [style.margin-left.em]="'2'" color="secondary">T</ion-note>
                          <ion-input type="text" formControlName="description" name="description"></ion-input>
                        </ion-item>
              
                        <ion-item disabled = "{{goalArray.controls[i].value.title === '' || goalTitle === ''}}">
                          <ion-label>The Importance is: </ion-label>
                          <ion-note slot="start" [style.margin-left.em]="'2'" color="secondary">T</ion-note>
                            <ion-select placeholder="Priority" formControlName="priority">
                              <ion-select-option *ngFor="let prior of priorities" [value]="prior.number">
                                {{ prior.text }}
                              </ion-select-option> 
                            </ion-select>
                        </ion-item>
                       
                        <ion-item disabled = "{{goalArray.controls[i].value.title === '' || goalTitle === ''}}">
                          <ion-label>The Difficulty Is:</ion-label>
                          <ion-note slot="start" [style.margin-left.em]="'2'" color="secondary">T</ion-note>
                          <ion-select placeholder="Difficulty" formControlName="difficulties">
                            <ion-select-option *ngFor="let diff of difficulty" [value]="diff.number">
                              {{diff.text}}
                            </ion-select-option>
                          </ion-select>
                        </ion-item> 
                       
                        <ion-item disabled = "{{goalArray.controls[i].value.title === '' || goalTitle === ''}}">
                          <ion-label>The Urgency is:</ion-label>
                          <ion-note slot="start" [style.margin-left.em]="'2'" color="secondary">T</ion-note>
                            <ion-select  formControlName="urgency">
                              <ion-select-option *ngFor="let urg of urgencyLevels" [value]="urg.number">
                                {{ urg.text }}
                              </ion-select-option> 
                            </ion-select>
                        </ion-item>
                        <ion-item disabled = "{{goalArray.controls[i].value.title === '' || goalTitle === ''}}">
                            <ion-label>Duration (Min): </ion-label>
                            <ion-note slot="start" [style.margin-left.em]="'2'" color="secondary">T</ion-note>
                            <ion-input
                              type="number"
                              formControlName="minutes"
                              name="minutes"
                            >
                          </ion-input>
                        </ion-item>
                      </ion-list>
                    
                        <br/>
                        <ion-item class="button-group" disabled = "{{goalArray.controls[i].value.title === '' || goalTitle === ''}}">
                           
                            <ion-badge slot="end" color="primary" (click)="addGoalChild(goal, j)">
                              <ion-icon name="add-circle-outline"></ion-icon>Task
                            </ion-badge>
                      

                            <ion-badge slot="end" id="add-M" color="dark" (click)="addTaskChild(task, j, getTaskChildren(goal))">
                              <ion-icon name="flag-outline"></ion-icon>Goal
                            </ion-badge>
                           
                            <ion-badge slot="end" color="danger" (click)="deleteTask(goal,j)">
                              <ion-icon name="ban-outline"></ion-icon> 
                            </ion-badge>

                            <ion-badge 
                              *ngIf="getTaskChildren(goal)[j].value.title !== '' || getTaskChildren(goal)[j].value.show"
                              slot="end" 
                              color="light" 
                              (click)="getTaskChildren(goal)[j].value.show = !getTaskChildren(goal)[j].value.show">
                              <ion-icon name="eye-off-outline"></ion-icon> 
                            </ion-badge>
                      
                        </ion-item>
                    </div> 
                    <ng-container *ngIf="!getTaskChildren(goal)[j].value.show">
                      <div class="no-edit-format">
                        <ion-item >
                          {{getTaskChildren(goal)[j].value.title}}
                        </ion-item>
                        <ion-item >
                          {{getTaskChildren(goal)[j].value.urgency}}
                        </ion-item>
                        <ion-item >
                          {{getTaskChildren(goal)[j].value.priority}}
                        </ion-item>
                        <ion-item >
                          {{getTaskChildren(goal)[j].value.difficulties}}
                        </ion-item>
                        <ion-item >
                          {{getTaskChildren(goal)[j].value.minutes}} minutes
                        </ion-item>
                        <ion-item >
                          
                            <ion-badge slot="end" 
                            *ngIf="goalArray.controls[i].value.title.value !== ''"
                              color="dark" 
                              (click)="getTaskChildren(goal)[j].value.show = !getTaskChildren(goal)[j].value.show">
                              <ion-icon name="eye-outline"></ion-icon>
                            </ion-badge>
                      
                        </ion-item>
                      </div>
                    </ng-container>
                  </div>
                </div>
            </div>
            <ng-container *ngIf="!goalArray.controls[i].value.show" >
              <div class="no-edit-format">
                <ion-item >
                  {{goalArray.controls[i].value.title}}
                </ion-item>
                <ion-item >
                  {{goalArray.controls[i].value.urgency}}
                </ion-item>
                <ion-item >
                  {{goalArray.controls[i].value.priority}}
                </ion-item>
                <ion-item >
                  {{goalArray.controls[i].value.difficulties}}
                </ion-item>
             
                <ion-item >
                  
                    <ion-badge slot="end" 
                       
                      color="dark" 
                      (click)="goalArray.controls[i].value.show = !goalArray.controls[i].value.show">
                      <ion-icon name="eye-outline"></ion-icon>
                    </ion-badge>
              
                </ion-item>
              </div>
            </ng-container>
        </div> 
      </div>  

    </form>

    <div id="submit-block">
      <ion-button type="submit" (click)="submitGoals()" disabled = "{{goalForm.invalid}}">Submit Goal</ion-button>
      <ion-button  color="danger" (click)="cancel()">Cancel</ion-button>
    </div>
    
</ion-content>